<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <base href=".">
    <link rel="Shortcut Icon" href="http://banxiaobao.com:8015/gbb/img/logotitle.png">
    <link rel="stylesheet" href="css/style.css" type="text/css">
    <link rel="stylesheet" href="css/left.css" type="text/css">
    <link rel="stylesheet" href="css/nav.css" type="text/css">
    <link rel="stylesheet" href="css/gatawaylist.css" type="text/css">
    <link type="text/css" rel="stylesheet" href="css/layer.css" id="skinlayercss">
    <link rel="stylesheet" href="css/dialog.css" type="text/css">


    <!--js区-->
    <script src="./js/jquery-1.7.1.min.js"></script>
    <script type="text/javascript" src="js/jquery.shove-1.0.js"></script>
    <script type="text/javascript" src="js/layer.min.js"></script>
    <script type="text/javascript" src="js/msg.js"></script>
    <script charset="utf-8" src="js/jquery.form.js"></script>
    <script src="./js/md5.js"></script>
    <script src="./js/lib/avalon.js"></script>
    <script src="./js/lib/common.js"></script>



    <script>
        avalon.ready(function(){
            var vm=avalon.define({
                $id:"deviceVm",
                user:{},
                degr_id:"",
                list:[],
                lastReq:0,
                ringReq:0,
                getDevice:function(){
                    $.ajax({
                        url:"http://www.kh122.com:8081/ChildrenBackstage/backstageServlet/deviceGroupApi/getDeviceGroupList",
                        type:"post",
                        data:{
                            user_id:vm.user.user_id,
                            tegr_id:vm.user.tegr_id,
                            page:1,
                            page_size:10,
                            last_req_time:vm.lastReq
                        },
                        success:function(data){
                            var json = eval("(" + data + ")");// 解析json
                            if(json.code==200){
                                var tar=json.result.list.filter(function(el){
                                    return el.user_id==vm.user.user_id;
                                })
                                vm.lastReq=json.result.last_req_time;
                                vm.degr_id=tar[0].degr_id;
                            }

                        }
                    })
                },
                getRing:function(){
                    $.ajax({
                        url:"http://www.kh122.com:8081/ChildrenBackstage/backstageServlet/deviceBraceletApi/getDeviceBraceletList",
                        type:'post',
                        data:{
                            user_id:vm.user.user_id,
                            degr_id:vm.degr_id,
                            page:1,
                            page_size:10,
                            last_req_time:vm.ringReq
                        }

                    })
                },
                router:function(str){
                    console.log(str)
                },
                init:function(){
                    var user=getLocalValue('user');
                    if(user==null){
                        console.log("失效")
                    }
                    vm.user=user;
                    vm.getDevice();
                }
            })

            vm.init();
            avalon.scan();
            vm.$watch('degr_id', function(value, oldValue) {
                vm.getRing();
            })

        })
    </script>
</head>


<body ms-controller="deviceVm">

<div class="baby_content">

    <!--头部-->
    <div ms-include-src=" './component/banner.html'" ></div>


    <div class="baby_conter_cd">
        <div class="baby_conter_left">
            <div class="baby_conter_li" id="teachLeft_Id">
                <a href="javascript:void(0)" id="attendance" class="baby_conter_school"><img src="img/buttom.png">设备管理</a>
                <a href="javascript:void(0)" id="teacher"  ms-click="switchData('ring')"><img src="img/buttom.png">手环管理</a>
                <a href="javascript:void(0)" id="class"    ms-click="switchData('ruler')"><img src="img/buttom.png">身高尺管理</a>
                <a href="javascript:void(0)" id="children" ms-click="switchData('steelyard')"><img src="img/buttom.png">健康秤管理</a>
            </div>
            <div class="Copyright">
                <div class="p">Powered by glorymi<br>深圳市科格微电子有限公司</div>
            </div>
        </div>

        <div class="baby_conter_right">
            <form action="http://banxiaobao.com:8015/gbb/admin/teacherList.do" method="post" id="formId">
                <input type="hidden" id="adminId" name="adminId">
                <input value="1" type="hidden" id="pageNum" name="pageNum">
                <table class="tb-type1 noborder search">
                    <tbody>
                    <tr>
                        <td>
                            <input placeholder="姓名" name="searchName" id="searchName">
                        </td>
                        <td><a href="javascript:;" id="search" class="btn-search " title="查询" onclick="chickSubmit();">
                            &nbsp;</a></td>
                    </tr>
                    </tbody>
                </table>
                <div class="baby_content_tab">
                    <ul class="baby_content_tab_menu">
                        <li>选择</li>
                        <li>姓名</li>
                        <li>班级</li>
                        <li>账号</li>
                        <li>成员类型</li>
                        <li>上次登录时间</li>
                        <li>操作</li>
                    </ul>
                    <ul class="baby_content_tab_ul1 ">
                        <li class="baby_tab_checkbox_li"><input type="checkbox" id="checkid_0" name="checkbox"
                                                                value="190 " onclick="checkBox(&#39;0&#39;,this);"></li>
                        <li>zhang</li>
                        <li></li>
                        <li>13971227532</li>
                        <li>
                            园长助理
                        </li>
                        <li>2016-09-19 15:19:06</li>
                        <li><a class="edit" href="javascript: void(0)" eid="190">编辑</a></li>
                    </ul>
                    <ul class="baby_content_tab_ul1 baby_content_tab_bg">
                        <li class="baby_tab_checkbox_li"><input type="checkbox" id="checkid_1" name="checkbox"
                                                                value="193 " onclick="checkBox(&#39;1&#39;,this);"></li>
                        <li>刘总</li>
                        <li></li>
                        <li>13332660866</li>
                        <li>
                            园长助理
                        </li>
                        <li>2016-10-28 14:53:18</li>
                        <li><a class="edit" href="javascript: void(0)" eid="193">编辑</a></li>
                    </ul>
                    <ul class="baby_content_tab_ul1 ">
                        <li class="baby_tab_checkbox_li"><input type="checkbox" id="checkid_2" name="checkbox"
                                                                value="147 " onclick="checkBox(&#39;2&#39;,this);"></li>
                        <li>蔡总</li>
                        <li>内部班</li>
                        <li>13823727161</li>
                        <li>
                            老师
                        </li>
                        <li>2016-08-30 14:36:04</li>
                        <li><a class="edit" href="javascript: void(0)" eid="147">编辑</a></li>
                    </ul>
                    <ul class="baby_content_tab_ul1 baby_content_tab_bg">
                        <li class="baby_tab_checkbox_li"><input type="checkbox" id="checkid_3" name="checkbox"
                                                                value="148 " onclick="checkBox(&#39;3&#39;,this);"></li>
                        <li>聂总</li>
                        <li>内部班</li>
                        <li>13798285925</li>
                        <li>
                            老师
                        </li>
                        <li>2016-12-24 10:23:34</li>
                        <li><a class="edit" href="javascript: void(0)" eid="148">编辑</a></li>


                    </ul>

                    <ul class="baby_content_tab_ul1 ">
                        <li class="baby_tab_checkbox_li"><input type="checkbox" id="checkid_4" name="checkbox"
                                                                value="149 " onclick="checkBox(&#39;4&#39;,this);"></li>
                        <li>周晶</li>
                        <li>内部班</li>
                        <li>18824397727</li>
                        <li>


                            班主任


                        </li>
                        <li>2017-02-13 10:22:14</li>


                        <li><a class="edit" href="javascript: void(0)" eid="149">编辑</a></li>


                    </ul>

                    <ul class="baby_content_tab_ul1 baby_content_tab_bg">
                        <li class="baby_tab_checkbox_li"><input type="checkbox" id="checkid_5" name="checkbox"
                                                                value="178 " onclick="checkBox(&#39;5&#39;,this);"></li>
                        <li>李恒</li>
                        <li>中班</li>
                        <li>18676727061</li>
                        <li>


                            班主任


                        </li>
                        <li>2017-02-14 14:01:23</li>


                        <li><a class="edit" href="javascript: void(0)" eid="178">编辑</a></li>


                    </ul>

                </div>
            </form>
            <div class="baby_content_dt">
                <div class="baby_content_dt-1">
                    <input type="checkbox" onclick="checkBoxAll(this);">
                    <span style="cursor: pointer;">全选</span>
                    <span class="baby_content_del" onclick="delAdmin();">批量删除</span>
                    <span class="baby_content_del edit">添加</span>
                </div>


                <!--<base href="http://banxiaobao.com:8015/gbb/">-->
                <base href=".">
                <title>网关列表</title>
                <link rel="stylesheet" href="css/style.css" type="text/css">
                <link rel="stylesheet" href="css/left.css" type="text/css">
                <link rel="stylesheet" href="css/gatawaylist.css" type="text/css">
                <script type="text/javascript" src="js/jquery-1.7.1.min.js"></script>
                <script type="text/javascript">
                    function goToPage(pagenum) {
                        $("#pageNum").val(pagenum);
                        $("#formId").submit();
                    }

                </script>


            </div>
        </div>
    </div>
</div>
<script type="text/javascript" src="js/jquery-1.7.1.min.js"></script>
<script type="text/javascript" src="js/jquery.shove-1.0.js"></script>
<script type="text/javascript" src="js/layer.min.js"></script>
<link rel="stylesheet" href="css/twitter.css">
<script type="text/javascript" src="js/jquery.artDialog.source.js"></script>
<script type="text/javascript" src="js/iframeTools.js"></script>
<script type="text/javascript" src="js/msg.js"></script>
<script type="text/javascript">
    function checkBoxAll(obj) {
        $("#adminId").val("");
        if (obj.checked == true) {
            $("[name='checkbox']").attr("checked", 'true');//全选
            var str = "";
            $("[name='checkbox'][checked]").each(function (i) {
                if (i == 0) {
                    str = $(this).val();
                } else {
                    str += "," + $(this).val();
                }
            });
            $("#adminId").val(str);

        } else {
            $("[name='checkbox']").removeAttr("checked");//取消全选
        }
    }
    function checkBox(index, obj) {
        $("#adminId").val("");
        if (obj.checked == true) {
            $("#checkid_" + index).attr("checked", true);
        } else {
            $("#checkid_" + index).attr("checked", false);
        }
        var str = "";
        $("[name='checkbox'][checked]").each(function (i) {
            if (i == 0) {
                str = $(this).val();
            } else {
                str += "," + $(this).val();
            }
        });
        $("#adminId").val(str);
    }

    function delAdmin() {
        var adminId = $("#adminId").val().trim();
        if (isNull(adminId)) {
            alertMsg("请先选择一条信息", 0);
            return;
        }
        if (confirm("确定要删除该消息吗？") != "0") {
            $.ajax({
                url: "admin/delAdmin.do",// 跳转到 action
                data: {
                    "ids": adminId
                },
                type: 'post',
                cache: false,
                success: function (data) {
                    if (data == 'loseSession') {
                        location.href = "http://banxiaobao.com:8015/gbb/admin/loginInit.do";
                        return;
                    }
                    var json = eval("(" + data + ")");// 解析json
                    var code = json.code;
                    if (code == 200) {
                        alertMsg("操作成功", 1);
                        window.location.reload();
                    } else {
                        alertMsg("操作失败", 2);
                    }
                },
                error: function () {
                    alertMsg("系统错误！", 2);
                }
            });
        }
    }
    function chickSubmit() {
        $("#formId").submit();
    }

    (function (config) {
        config['lock'] = true;
        config['fixed'] = true;
        config['opacity'] = .4;
        config['okVal'] = '确定';
        config['cancelVal'] = '取消';
        // [more..]
    })(art.dialog.defaults);


    $(function () {
        $("#searchName").val("");

        $(".edit").click(function () {
            var $this = $(this);
            var eid = $this.attr("eid");
            var title = '编辑';
            if (eid == undefined) {
                eid = "";
                title = '新增';
            }
            art.dialog.open("admin/editTeacher.do?id=" + eid, {
                width: 600,
                height: 470,
                title: title,
                // 在open()方法中，init会等待iframe加载完毕后执行
                init: function () {
                    //var iframe = this.iframe.contentWindow;
                    //var top = art.dialog.top;// 引用顶层页面window对象

                },
                ok: function () {
                    var iframe = this.iframe.contentWindow;
                    if (!iframe.document.body) {
                        alert('iframe还没加载完毕呢');
                        return false;
                    }
                    ;
                    var dialog = this;
                    iframe.submitAdmin(function (state) {
                        switch (state) {
                            case 0: // 成功
                                dialog.close();
                                window.location.reload();
                                break;
                            case 2: // 未登录
                                location.href = "http://banxiaobao.com:8015/gbb/admin/loginInit.do";
                                break;
                            default:
                                break;
                        }
                    });
                    return false;
                },
                cancel: true
            });
        });
    });
</script>
</body>
</html>