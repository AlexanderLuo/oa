<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>幼儿安全健康管理</title>
    <link rel="Shortcut Icon" href="http://banxiaobao.com:8015/gbb/img/logotitle.png">
    <link rel="stylesheet" href="css/style.css" type="text/css">
    <link rel="stylesheet" href="css/left.css" type="text/css">
    <link rel="stylesheet" href="css/nav.css" type="text/css">
    <link rel="stylesheet" href="css/gatawaylist.css" type="text/css">
    <link type="text/css" rel="stylesheet" href="css/layer.css" id="skinlayercss">
    <link rel="stylesheet" href="css/dialog.css" type="text/css">
    <link rel="stylesheet" href="css/twitter.css" type="text/css">

    <!--js区-->
    <script src="./js/jquery-1.7.1.min.js"></script>
    <script type="text/javascript" src="js/jquery.shove-1.0.js"></script>
    <script type="text/javascript" src="js/layer.min.js"></script>
    <script type="text/javascript" src="js/msg.js"></script>
    <script charset="utf-8" src="js/jquery.form.js"></script>
    <script src="./js/md5.js"></script>
    <script src="./js/lib/avalon.js"></script>
    <script src="./js/lib/common.js"></script>
    <script type="text/javascript" src="js/jquery.artDialog.source.js"></script>
    <script type="text/javascript" src="js/iframeTools.js"></script>


    <style>
        .show{
            display: table!important;
        }
        .block{
            display: block!important;
        }
    </style>
    <script>
        avalon.ready(function () {
            var vm = avalon.define({
                $id: "deviceVm",
                //公用
                conf:{},
                user: {},
                degr_id: "",   //当前用户设备组
                dataList:[],
                deviceReq:0,
                ringReq: 0,
                rulerReq:0,
                steelyardReq:0,
                pageNo:1,
                pageSize:10,





                //逻辑
                queryUrl:"",
                queryData:{},
                addUrl:"",
                addData:{},
                revUrl:"",
                revData:{},
                delUrl:"",
                delData:"",



                //控制
                weight:1,  //权限
                curPage: "",  //当前路由
                checkAllFlag:false,  //全选标志
                pop:false,
                popData:{},


                query:function(pageNo){
                    vm.pageNo=pageNo;
                    var path = vm.upperPage();
                    $.ajax({url: vm.queryUrl, type: "post", data: vm.queryData.$model}).done(function(data){vm.queryHandle(data,vm["get"+path])})
                },
                del:function(){
                },
                add:function(){
                    var path = vm.upperPage();
                    vm.popData.collecData();
                    var check=vm.popData.isLegal();
                    if(check){
                        $.ajax({url: vm.addUrl, type: "post", data: vm.addData.$model}).done(function(data){vm.addHandle(data,vm["add"+path])})
                    }else{
                        console.log("worng");
                    }
                    vm.close();
                },
                rev:function(){
                },
                queryHandle(data,callback,error){
                    var json = eval("(" + data + ")");// 解析json
                    if (json.code == 200) {
                        callback(json);
                    }else{
                        error && error.call()
                    }
                },
                addHandle(data,callback,error){
                    var json = eval("(" + data + ")");// 解析json
                    if (json.code == 200) {
                        callback(json);
                    }else{
                        error && error.call()
                    }
                },
                //查询设备
                getDevice: function (json) {
                    vm.deviceReq = json.result.last_req_time;
                    var tar=json.result.list.filter(function(el){
                        return el.user_id==vm.user.user_id;
                    });
                    vm.degr_id=tar[0].degr_id;
                    json.result.list.forEach(function(el){
                        el.check=false;
                    });
                    vm.dataList = json.result.list;
                },
                //查询手环
                getRing: function (json) {
                    vm.ringReq = json.result.last_req_time;
                    json.result.list.forEach(function(el){
                        el.check=false;
                    });
                    vm.dataList = json.result.list;
                },
                //身高尺
                getRuler: function (json) {
                    vm.rulerReq = json.result.last_req_time;
                    json.result.list.forEach(function(el){
                        el.check=false;
                    });
                    vm.dataList = json.result.list;
                },
//                健康秤
                getSteelyard: function (json) {
                    vm.steelyardReq= json.result.last_req_time;
                    json.result.list.forEach(function(el){
                        el.check=false;
                    });
                    vm.dataList = json.result.list;
                },

                delDevice:function(){
                },
                delRing:function(){
                },
                delRuler:function(){
                },
                delSteelyard:function(){
                },
                addDevice:function(){
                },
                addRing:function(){
                },
                addRuler:function(){
                },
                addSteelyard:function(){
                },
                revDevice:function(){
                },
                revRing:function(){
                },
                revRuler:function(){
                },
                revSteelyard:function(){
                },

                //路由
                router: function (str) {
                    vm.dataList=[];
                    vm.checkAllFlag=false;
                    vm.curPage=str;
                    vm.pageAdapter();
                    vm.query(1);
                },
                //单词首字母大写
                upperPage:function(){
                    var word = vm.curPage.toLowerCase().replace(/\b\w+\b/g, function(word){
                        return word.substring(0,1).toUpperCase()+word.substring(1);
                    });
                    return word;
                },
                //路由适配
                pageAdapter:function(str){
                    if(!str){
                        var path = vm.upperPage();
                        var c=vm.conf;
                        var b= c.baseUrl;
                        vm.addUrl= b+ c["add"+path]
                        vm.delUrl= b+ c["del"+path]
                        vm.revUrl= b+ c["rev"+path]
                        vm.queryUrl=b+c["query"+path]
                        switch (vm.curPage){
                            case "device":
                                    vm.queryData= {
                                        user_id: vm.user.user_id,
                                        tegr_id: vm.user.tegr_id,
                                        page: vm.pageNo,
                                        page_size:  vm.pageSize,
                                        last_req_time: vm.deviceReq
                                    }
                                    vm.popData={
                                        title:"设备组",
                                        rows:[{name:"集团ID",key:"",value:""},{name:"所属用户ID",key:"",value:""},{name:"设备组名称",key:"",value:""}],
                                        isLegal:function(){
                                           if(vm.popData.rows[0].value==""){
                                               return false;
                                           } else{
                                               return true;
                                           }
                                        },
                                        collecData:function(){
                                            vm.addData={
                                                tegr_id:vm.popData.rows[0].value,
                                                user_id:vm.popData.rows[1].value,
                                                degr_name:vm.popData.rows[2].value
                                            }
                                        }
                                    }
                                break;
                            case "ring":
                                    vm.queryData={
                                        user_id: vm.user.user_id,
                                        degr_id: vm.degr_id,
                                        page: vm.pageNo,
                                        page_size:  vm.pageSize,
                                        last_req_time: vm.ringReq
                                    }
                                vm.popData={
                                    title:"手环",
                                    rows:[{name:"学生ID",key:"",value:""},{name:"设备组ID",key:"",value:""},{name:"手环编号",key:"",value:""},{name:"手环地址",key:"",value:""}]
                                }
                                break;
                            case "ruler":
                                    vm.queryData={
                                        user_id: vm.user.user_id,
                                        tegr_id: vm.user.tegr_id,
                                        page: vm.pageNo,
                                        page_size:  vm.pageSize,
                                        last_req_time: vm.ringReq
                                    };
                                    vm.popData={
                                        title:"身高尺",
                                        rows:[{name:"身高尺编号",key:"",value:""},{name:"身高尺地址",key:"",value:""},{name:"集团ID",key:"",value:""}]
                                    }
                                    vm.addData={

                                    }

                                break;
                            case "steelyard":
                                    vm.queryData={
                                        user_id: vm.user.user_id,
                                        tegr_id: vm.user.tegr_id,
                                        page: vm.pageNo,
                                        page_size:  vm.pageSize,
                                        last_req_time: vm.ringReq
                                    }
                                vm.popData={
                                    title:"健康秤",
                                    rows:[{name:"健康秤编号",key:"",value:""},{name:"健康秤地址",key:"",value:""},{name:"集团ID",key:"",value:""}]
                                }
                                break;
                        }
                    }

                },
                //单选
                checkOne:function(el){
                    el.check=!el.check;
                    var no=vm.dataList.filter(function(al){
                        return al.check==false;
                    })
                    if(no.length==0){
                        vm.checkAllFlag=true
                    }
                    if(no.length>0){
                        vm.checkAllFlag=false
                    }

                },
                //弹窗
                open:function(){
                    vm.pop=true;
                },
                //关掉
                close:function(){
                    vm.pop=false;
                },
                //全选
                checkAll:function(){
                    vm.checkAllFlag=!vm.checkAllFlag
                    vm.dataList.forEach(function(el){
                        el.check=vm.checkAllFlag;
                    })
                },
                //初始化
                init: function () {
                    var user = getLocalValue('user');
                    if (user == null) {location.href="/oa/login.html";}
                    vm.user = user;
                    var ty=user.role_type;
                    if(ty=="8"){vm.weight=2}
                    else if(ty=="16" || ty=="32"){vm.weight=3}
                    else{vm.weight=1}
                    $.ajax({
                        url: "/oa/conf/config.json",
                        async:false,
                        success: function(res){
                            vm.conf=res
                        }
                    });
                    vm.router("device")
                }
            })



            avalon.scan()
            vm.init();

        })
    </script>
</head>


<body ms-controller="deviceVm">

<div class="baby_content">

    <!--头部-->
    <div ms-include-src=" './component/banner.html'"></div>

     <!--子导航栏-->
    <div class="baby_conter_cd">
        <div class="baby_conter_left">
            <div class="baby_conter_li">
                <a ms-class="baby_conter_school:curPage == 'device' "      ms-click="router('device')"><img src="img/buttom.png">设备管理</a>
                <a ms-class="baby_conter_school:curPage == 'ring'   "      ms-click="router('ring')"><img src="img/buttom.png">手环管理</a>
                <a ms-class="baby_conter_school:curPage == 'ruler'  "      ms-click="router('ruler')"><img src="img/buttom.png">身高尺管理</a>
                <a ms-class="baby_conter_school:curPage == 'steelyard' "   ms-click="router('steelyard')"><img src="img/buttom.png">健康秤管理</a>
            </div>
            <div class="Copyright">
                <div class="p">Powered by glorymi<br>深圳市伴小宝科技有限公司</div>
            </div>
        </div>



        <div class="baby_conter_right">
            <form>

                <!--设备组选择框-->
                <div class="select" ms-if="curPage=='ring'">
                    <span>设备组：&nbsp;</span>
                    <select name=""  ms-duplex="deger_id">
                        <option ms-attr-value="{{el.deger_id}}" ms-repeat="dataList">{{el.tegr_name}}</option>
                    </select>
                </div>

                <!--集团选择框-->
                <div class="select" ms-if="curPage=='ruler'|| curPage =='steelyard'">
                    <span>集团：&nbsp;</span>
                    <select name="" id="" ms-duplex="teger_id">
                        <option ms-attr-value="{{el.teger_id}}" ms-repeat="tegerList">{{el.tegr_name}}</option>
                    </select>
                </div>

                <!--设备组数据-->
                <div class="baby_content_tab"     style="display: none"  ms-class="show:curPage == 'device'"  ms-if="curPage == 'device' ">
                    <ul class="baby_content_tab_menu">
                        <li>选择</li>
                        <li>设备组名称</li>
                        <li>设备组老师</li>
                        <li>教师集团</li>
                        <li>创建时间</li>
                        <li>操作</li>
                    </ul>

                    <!--数据-->
                    <ul class="baby_content_tab_ul1 " ms-repeat="dataList" ms-class = "baby_content_tab_bg:$index%2!=0">
                        <li class="baby_tab_checkbox_li"><input type="checkbox"  ms-attr-checked="el.check"  ms-click="checkOne(el)" /></li>
                        <li>{{el.degr_id}}</li>
                        <li>{{el.degr_name}}</li>
                        <li>{{el.tegr_name}}</li>
                        <li>{{el.create_time | date('yyyy-MM-dd') }}</li>
                        <li ><a class="edit" href="javascript: void(0)"  ms-if="weight>=2">编辑</a></li>
                    </ul>
                </div>


            <!--    &lt;!&ndash;手环组数据-->
                <div class="baby_content_tab"  style="display: none"  ms-class="show:curPage == 'ring'"  ms-if="curPage == 'ring' ">
                    <ul class="baby_content_tab_menu">
                        <li>选择</li>
                        <li>手环编号</li>
                        <li>手环mac地址</li>
                        <li>设备组名称</li>
                        <li>操作</li>
                    </ul>
                    <!--数据-->
                    <ul class="baby_content_tab_ul1 " ms-repeat="dataList" ms-class = "baby_content_tab_bg:$index%2!=0">
                        <li class="baby_tab_checkbox_li"><input type="checkbox"    ms-attr-checked="el.check"   ms-click="checkOne(el)"/></li>
                        <li>{{el.bracelet_no}}</li>
                        <li>{{el.bracelet_address}}</li>
                        <li>{{el.degr_name}}</li>
                        <li><a class="edit" href="javascript: void(0)" >编辑</a></li>
                    </ul>
                </div>



                <!--&lt;!&ndash;身高尺数据&ndash;&gt;-->
                <div class="baby_content_tab" style="display: none"  ms-class="show:curPage == 'ruler'"   ms-if="curPage =='ruler'">
                    <ul class="baby_content_tab_menu">
                        <li>选择</li>
                        <li>身高尺编号</li>
                        <li>身高尺mac地址</li>
                        <li>身高尺负责人</li>
                        <li>负责人集团名称</li>
                        <li>操作</li>
                    </ul>
                    <!--&lt;!&ndash;数据&ndash;&gt;-->
                    <ul class="baby_content_tab_ul1 " ms-repeat="dataList" ms-class = "baby_content_tab_bg:$index%2!=0">
                        <li class="baby_tab_checkbox_li"><input type="checkbox"   ms-attr-checked="el.check"  ms-click="checkOne(el)"/></li>
                        <li>{{el.ruler_no}}</li>
                        <li>{{el.ruler_addr}}</li>
                        <li>{{el.name}}</li>
                        <li>{{el.tegr_name}}</li>
                        <li><a class="edit" href="javascript: void(0)" ms-if="weight>=2">编辑</a></li>
                    </ul>
                </div>


                <!--&lt;!&ndash;健康秤数据&ndash;&gt;-->
                <div class="baby_content_tab" style="display: none"  ms-class="show:curPage == 'steelyard'"  ms-if="curPage =='steelyard'" >
                    <ul class="baby_content_tab_menu">
                        <li>选择</li>
                        <li>健康秤编号</li>
                        <li>健康秤mac地址</li>
                        <li>健康秤负责人</li>
                        <li>负责人集团名称</li>
                        <li>操作</li>
                    </ul>
                    <!--&lt;!&ndash;数据&ndash;&gt;-->
                    <ul class="baby_content_tab_ul1 " ms-repeat="dataList" ms-class = "baby_content_tab_bg:$index%2!=0">
                        <li class="baby_tab_checkbox_li"><input type="checkbox"    ms-attr-checked="el.check"  ms-click="checkOne(el)"/></li>
                        <li>{{el.scales_no}}</li>
                        <li>{{el.scales_addr}}</li>
                        <li>{{el.name}}</li>
                        <li>{{el.tegr_name}}</li>
                        <li><a class="edit" href="javascript: void(0)"  ms-if="weight>=2">编辑</a></li>
                    </ul>
                </div>
            </form>

            <div class="baby_content_dt">
                <div class="baby_content_dt-1">
                    <input type="checkbox" ms-attr-checked="checkAllFlag" ms-click="checkAll">
                    <span style="cursor: pointer;" >全选</span>
                    <span class="baby_content_del" ms-click="open('del')">批量删除</span>
                    <span class="baby_content_del edit" ms-click="open('add')">添加</span>
                </div>



                <!--弹窗-->
                    <div class="shade"   ms-class="block:pop">
                            <div class="user-edit">
                                <div class="user-main">
                                    <div class="user-title">
                                        <h3>{{popData.title}}</h3>
                                    </div>

                                    <table class="table_1" cellpadding="0" cellspacing="0">
                                        <tr ms-repeat="popData.rows">
                                            <th width="40%">{{el.name}}：</th>
                                            <td width="60%"><input type="text" name="" ms-duplex="el.value"/>
                                            </td>
                                        </tr>
                                    </table>
                                    <div class="user-btn">
                                        <input type="button" value="保存" class="oper" ms-click="add"/>
                                        <input type="button" value="返回" class="oper" ms-click="close"/>
                                    </div>
                                </div>
                            </div>
                    </div>
            </div>
        </div>
    </div>
</div>
</body>





<!--query脚本-->
<script type="text/javascript">
    function delAdmin() {
        var adminId = $("#adminId").val().trim();
        if (isNull(adminId)) {
            alertMsg("请先选择一条信息", 0);
            return;
        }
        if (confirm("确定要删除该消息吗？") != "0") {
            $.ajax({
                url: "admin/delAdmin.do",// 跳转到 action
                data: {
                    "ids": adminId
                },
                type: 'post',
                cache: false,
                success: function (data) {
                    if (data == 'loseSession') {
                        location.href = "http://banxiaobao.com:8015/gbb/admin/loginInit.do";
                        return;
                    }
                    var json = eval("(" + data + ")");// 解析json
                    var code = json.code;
                    if (code == 200) {
                        alertMsg("操作成功", 1);
                        window.location.reload();
                    } else {
                        alertMsg("操作失败", 2);
                    }
                },
                error: function () {
                    alertMsg("系统错误！", 2);
                }
            });
        }
    }


</script>
</html>