<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>幼儿安全健康管理</title>
    <link rel="Shortcut Icon" href="http://banxiaobao.com:8015/gbb/img/logotitle.png">
    <link rel="stylesheet" href="css/style.css" type="text/css">
    <link rel="stylesheet" href="css/left.css" type="text/css">
    <link rel="stylesheet" href="css/nav.css" type="text/css">
    <link rel="stylesheet" href="css/gatawaylist.css" type="text/css">
    <link type="text/css" rel="stylesheet" href="css/layer.css" id="skinlayercss">
    <link rel="stylesheet" href="css/dialog.css" type="text/css">
    <link rel="stylesheet" href="css/twitter.css" type="text/css">

    <!--js区-->
    <script src="./js/jquery-1.7.1.min.js"></script>
    <script type="text/javascript" src="js/jquery.shove-1.0.js"></script>
    <script type="text/javascript" src="js/layer.min.js"></script>
    <script type="text/javascript" src="js/msg.js"></script>
    <script charset="utf-8" src="js/jquery.form.js"></script>
    <script src="./js/md5.js"></script>
    <script src="./js/lib/avalon.js"></script>
    <script src="./js/lib/common.js"></script>
    <script type="text/javascript" src="js/jquery.artDialog.source.js"></script>
    <script type="text/javascript" src="js/iframeTools.js"></script>


    <style>
        .show{
            display: table!important;
        }
        .block{
            display: block!important;
        }
    </style>
    <script>
        avalon.ready(function () {
            var vm = avalon.define({
                $id: "deviceVm",
                //公用
                conf:{},
                user: {},
                degr_id: "",   //当前用户设备组
                dataList:[],
                lastReq: 0,
                weight:1,  //权限
                curPage: "",  //当前路由
                checkAllFlag:false,  //全选标志
                pop:false,
                pageNo:1,
                pageSize:10,


                deviceReq:0,
                ringReq: 0,
                rulerReq:0,
                steelyardReq:0,

                query:function(pageNo){
                    vm.pageNo=pageNo;
                    if(vm.curPage=="device"){vm.getDevice()}
                    if(vm.curPage=="ring"){  vm.getRing()}
                    if(vm.curPage=="ruler"){ vm.getRuler()}
                    if(vm.curPage=='steelyard'){ vm.getSteelyard()}
                },
                del:function(){
                    if(vm.curPage=="device"){vm.getDevice()}
                    if(vm.curPage=="ring"){  vm.getRing()}
                    if(vm.curPage=="ruler"){ vm.getRuler()}
                    if(vm.curPage=='steelyard'){ vm.getSteelyard()}
                },
                add:function(){
                    if(vm.curPage=="device"){vm.getDevice()}
                    if(vm.curPage=="ring"){  vm.getRing()}
                    if(vm.curPage=="ruler"){ vm.getRuler()}
                    if(vm.curPage=='steelyard'){ vm.getSteelyard()}
                },
                rev:function(){
                    if(vm.curPage=="device"){vm.getDevice()}
                    if(vm.curPage=="ring"){  vm.getRing()}
                    if(vm.curPage=="ruler"){ vm.getRuler()}
                    if(vm.curPage=='steelyard'){ vm.getSteelyard()}
                },
                //查询设备
                getDevice: function () {
                    $.ajax({
                        url: vm.conf.baseUrl+vm.conf.queryDevice,
                        type: "post",
                        data: {
                            user_id: vm.user.user_id,
                            tegr_id: vm.user.tegr_id,
                            page: vm.pageNo,
                            page_size:  vm.pageSize,
                            last_req_time: vm.deviceReq
                        },
                        success: function (data) {
                            var json = eval("(" + data + ")");// 解析json
                            if (json.code == 200) {
                                vm.deviceReq = json.result.last_req_time;
                                var tar=json.result.list.filter(function(el){
                                    return el.user_id==vm.user.user_id;
                                })
                                vm.degr_id=tar[0].degr_id
                                json.result.list.forEach(function(el){
                                    el.check=false;
                                })
                                vm.dataList = json.result.list;
                            }

                        }
                    })
                },
                //查询手环
                getRing: function () {
                    $.ajax({
                        url: vm.conf.baseUrl+vm.conf.queryRing,
                        type: 'post',
                        data: {
                            user_id: vm.user.user_id,
                            degr_id: vm.degr_id,
                            page: vm.pageNo,
                            page_size:  vm.pageSize,
                            last_req_time: vm.ringReq
                        },
                        success: function (data) {
                            var json = eval("(" + data + ")");// 解析json
                            if (json.code == 200) {
                                vm.ringReq = json.result.last_req_time;
                                json.result.list.forEach(function(el){
                                    el.check=false;
                                })
                                vm.dataList = json.result.list;
                            }
                        }

                    })
                },
                //身高尺
                getRuler: function () {
                    $.ajax({
                        url: vm.conf.baseUrl+vm.conf.queryRuler,
                        type: 'post',
                        data: {
                            user_id: vm.user.user_id,
                            tegr_id: vm.user.tegr_id,
                            page: vm.pageNo,
                            page_size:  vm.pageSize,
                            last_req_time: vm.ringReq
                        },
                        success: function (data) {
                            var json = eval("(" + data + ")");// 解析json
                            if (json.code == 200) {
                                vm.rulerReq = json.result.last_req_time;
                                json.result.list.forEach(function(el){
                                    el.check=false;
                                })
                                vm.dataList = json.result.list;
                            }
                        }

                    })
                },
//                健康秤
                getSteelyard: function () {
                    $.ajax({
                        url: vm.conf.baseUrl+vm.conf.querySteelyard,
                        type: 'post',
                        data: {
                            user_id: vm.user.user_id,
                            tegr_id: vm.user.tegr_id,
                            page: vm.pageNo,
                            page_size:  vm.pageSize,
                            last_req_time: vm.ringReq
                        },
                        success: function (data) {
                            var json = eval("(" + data + ")");// 解析json
                            console.log(json);
                            if (json.code == 200) {
                                vm.steelyardReq= json.result.last_req_time;
                                json.result.list.forEach(function(el){
                                    el.check=false;
                                })
                                vm.dataList = json.result.list;
                            }
                        }

                    })
                },
                delDevice:function(){
                },
                delRing:function(){
                },
                delRuler:function(){
                },
                delSteelyard:function(){
                },
                addDevice:function(){
                },
                addRing:function(){
                },
                addRuler:function(){
                },
                addSteelyard:function(){
                },
                revDevice:function(){
                },
                revRing:function(){
                },
                revRuler:function(){
                },
                revSteelyard:function(){
                },

                //路由
                router: function (str) {
                    vm.dataList=[];
                    vm.checkAllFlag=false;
                    vm.curPage=str;
                    vm.query(1);
                },
                //单选
                checkOne:function(el){
                    el.check=!el.check;
                    var no=vm.dataList.filter(function(al){
                        return al.check==false;
                    })
                    if(no.length==0){
                        vm.checkAllFlag=true
                    }
                    if(no.length>0){
                        vm.checkAllFlag=false
                    }

                },
                //弹窗
                open:function(str){

                    vm.pop=true;
                },
                //全选
                checkAll:function(){
                    vm.checkAllFlag=!vm.checkAllFlag
                    vm.dataList.forEach(function(el){
                        el.check=vm.checkAllFlag;
                    })
                },
                //初始化
                init: function () {
                    var user = getLocalValue('user');
                    if (user == null) {location.href="/oa/login.html";}
                    vm.user = user;
                    var ty=user.role_type;
                    if(ty=="8"){vm.weight=2}
                    else if(ty=="16" || ty=="32"){vm.weight=3}
                    else{vm.weight=1}
                    $.ajax({
                        url: "/oa/conf/config.json",
                        async:false,
                        success: function(res){
                            vm.conf=res
                        }
                    });
                    vm.router("statement")
                }
            })

            avalon.scan()
            vm.init();

        })
    </script>
</head>


<body ms-controller="deviceVm">

<div class="baby_content">

    <!--头部-->
    <div ms-include-src=" './component/banner.html'"></div>

    <!--子导航栏-->
    <div class="baby_conter_cd">
        <div class="baby_conter_left">
            <div class="baby_conter_li">
                <a ms-class="baby_conter_school:curPage == 'statement' "      ms-click="router('statement')"><img src="img/buttom.png">学生报表管理</a>
            </div>
            <div class="Copyright">
                <div class="p">Powered by glorymi<br>深圳市伴小宝科技有限公司</div>
            </div>
        </div>



        <div class="baby_conter_right">
            <form>
                <!--设备组数据-->
                <div class="baby_content_tab"     style="display: none"  ms-class="show:curPage == 'statement'"  ms-if="curPage == 'statement' ">
                    <ul class="baby_content_tab_menu">
                        <li>选择</li>
                        <li>集团名称</li>
                        <li>学校名称</li>
                        <li>班级名称</li>
                        <li>操作</li>
                    </ul>

                    <!--数据-->
                    <ul class="baby_content_tab_ul1 " ms-repeat="dataList" ms-class = "baby_content_tab_bg:$index%2!=0">
                        <li class="baby_tab_checkbox_li"><input type="checkbox"  ms-attr-checked="el.check"  ms-click="checkOne(el)" /></li>
                        <li>{{el.degr_id}}</li>
                        <li>{{el.degr_name}}</li>
                        <li>{{el.tegr_name}}</li>
                        <li>{{el.create_time | date('yyyy-MM-dd') }}</li>
                        <li ><a class="edit" href="javascript: void(0)"  ms-if="weight>=2">编辑</a></li>
                    </ul>
                </div>

            </form>

            <div class="baby_content_dt">
                <div class="baby_content_dt-1">
                    <input type="checkbox" ms-attr-checked="checkAllFlag" ms-click="checkAll">
                    <span style="cursor: pointer;" >全选</span>
                    <span class="baby_content_del" ms-click="open('del')">批量删除</span>
                    <span class="baby_content_del edit" ms-click="open('add')">添加</span>
                    <span class="baby_content_del edit" ms-click="">报表下载</span>
                </div>





                <!--弹窗-->
                <div class="shade"   ms-class="block:pop">
                    <div class="user-edit">
                        <div class="user-main">
                            <div class="user-title">
                                <h3>设备组：</h3>
                            </div>
                            <table class="table_1" cellpadding="0" cellspacing="0">
                                <tr>
                                    <th width="40%">设备组名称：</th>
                                    <td width="60%"><input type="text" name="" ms-duplex-string=""/>
                                    </td>
                                </tr>
                                <tr>
                                    <th width="40%">设备组老师：</th>
                                    <td width="60%"><input type="text" name="" ms-duplex-string=""/>
                                    </td>
                                </tr>
                                <tr>
                                    <th width="40%">教师集团：</th>
                                    <td width="60%"><input type="text" name="" ms-duplex-string=""/></td>
                                </tr>
                                <tr>
                                    <th width="40%">创建时间：</th>
                                    <td width="60%"><input type="text" name="" ms-duplex-string=""/>
                                    </td>
                                </tr>
                            </table>
                            <div class="user-btn">
                                <input type="button" value="保存" class="oper" ms-click="save"/>
                                <input type="button" value="返回" class="oper" ms-click="back"/>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>







<!--query脚本-->
<script type="text/javascript">
    function delAdmin() {
        var adminId = $("#adminId").val().trim();
        if (isNull(adminId)) {
            alertMsg("请先选择一条信息", 0);
            return;
        }
        if (confirm("确定要删除该消息吗？") != "0") {
            $.ajax({
                url: "admin/delAdmin.do",// 跳转到 action
                data: {
                    "ids": adminId
                },
                type: 'post',
                cache: false,
                success: function (data) {
                    if (data == 'loseSession') {
                        location.href = "http://banxiaobao.com:8015/gbb/admin/loginInit.do";
                        return;
                    }
                    var json = eval("(" + data + ")");// 解析json
                    var code = json.code;
                    if (code == 200) {
                        alertMsg("操作成功", 1);
                        window.location.reload();
                    } else {
                        alertMsg("操作失败", 2);
                    }
                },
                error: function () {
                    alertMsg("系统错误！", 2);
                }
            });
        }
    }


</script>
</html>